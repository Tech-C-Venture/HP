<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tech.C Venture - 管理画面</title>
    <link rel="stylesheet" href="/admin/preview-styles.css" />
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Decap CMS のスクリプトを読み込み -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

    <!-- カスタムプレビューテンプレート（必要に応じて追加） -->
    <script>
      // ブログ記事のプレビューテンプレート
      const BlogPostPreview = createClass({
        render() {
          const entry = this.props.entry;
          const title = entry.getIn(['data', 'title']);
          const body = entry.getIn(['data', 'body']);
          const date = entry.getIn(['data', 'date']);
          const category = entry.getIn(['data', 'category']);
          const image = entry.getIn(['data', 'image']);

          return h('div', { className: 'blog-preview' },
            h('div', { className: 'blog-preview-header' },
              image && h('img', { src: image, alt: title, style: { width: '100%', height: '200px', objectFit: 'cover', marginBottom: '1rem' } }),
              h('div', { style: { display: 'flex', gap: '1rem', marginBottom: '0.5rem', fontSize: '0.875rem', color: '#666' } },
                h('span', {}, new Date(date).toLocaleDateString('ja-JP')),
                category && h('span', { style: { backgroundColor: '#007acc', color: 'white', padding: '0.25rem 0.5rem', borderRadius: '0.25rem' } }, category)
              ),
              h('h1', { style: { fontSize: '2rem', fontWeight: 'bold', marginBottom: '1rem' } }, title)
            ),
            h('div', {
              className: 'blog-preview-content',
              style: { lineHeight: '1.6', color: '#333' },
              dangerouslySetInnerHTML: { __html: this.props.widgetFor('body') }
            })
          );
        }
      });

      // パートナー企業のプレビューテンプレート
      const PartnerPreview = createClass({
        render() {
          const entry = this.props.entry;
          const name = entry.getIn(['data', 'name']);
          const description = entry.getIn(['data', 'description']);
          const logo = entry.getIn(['data', 'logo']);
          const type = entry.getIn(['data', 'type']);
          const support = entry.getIn(['data', 'support']);

          return h('div', { className: 'partner-preview', style: { padding: '2rem', border: '1px solid #e5e7eb', borderRadius: '0.5rem', backgroundColor: 'white' } },
            logo && h('div', { style: { textAlign: 'center', marginBottom: '1rem', padding: '1rem', backgroundColor: '#f8f9fa', borderRadius: '0.5rem' } },
              h('img', { src: logo, alt: name, style: { maxWidth: '200px', maxHeight: '80px', objectFit: 'contain' } })
            ),
            h('h3', { style: { fontSize: '1.25rem', fontWeight: '600', marginBottom: '0.5rem' } }, name),
            type && h('span', { style: { backgroundColor: '#007acc', color: 'white', padding: '0.25rem 0.5rem', borderRadius: '0.25rem', fontSize: '0.75rem', marginBottom: '1rem', display: 'inline-block' } }, type),
            h('p', { style: { color: '#666', lineHeight: '1.6', marginBottom: '1rem' } }, description),
            support && h('p', { style: { color: '#666', fontSize: '0.875rem' } }, '支援内容: ', support)
          );
        }
      });

      // メンターのプレビューテンプレート
      const MentorPreview = createClass({
        render() {
          const entry = this.props.entry;
          const name = entry.getIn(['data', 'name']);
          const role = entry.getIn(['data', 'role']);
          const avatar = entry.getIn(['data', 'avatar']);
          const description = entry.getIn(['data', 'description']);
          const skills = entry.getIn(['data', 'skills']);

          return h('div', { className: 'mentor-preview', style: { padding: '2rem', border: '1px solid #e5e7eb', borderRadius: '0.5rem', backgroundColor: 'white', textAlign: 'center' } },
            avatar && h('div', { style: { marginBottom: '1rem' } },
              h('img', { src: avatar, alt: name, style: { width: '120px', height: '120px', borderRadius: '50%', objectFit: 'cover', margin: '0 auto' } })
            ),
            h('h3', { style: { fontSize: '1.25rem', fontWeight: '600', marginBottom: '0.5rem' } }, name),
            role && h('p', { style: { color: '#007acc', fontWeight: '600', marginBottom: '1rem' } }, role),
            h('p', { style: { color: '#666', lineHeight: '1.6', marginBottom: '1rem' } }, description),
            skills && skills.size > 0 && h('div', { style: { display: 'flex', flexWrap: 'wrap', gap: '0.5rem', justifyContent: 'center' } },
              skills.entrySeq().map(([index, skill]) =>
                h('span', { key: index, style: { backgroundColor: '#f8f9fa', color: '#333', padding: '0.25rem 0.5rem', borderRadius: '0.25rem', fontSize: '0.75rem' } }, skill)
              )
            )
          );
        }
      });

      // プレビューテンプレートを登録
      CMS.registerPreviewTemplate('blog', BlogPostPreview);
      CMS.registerPreviewTemplate('partners', PartnerPreview);
      CMS.registerPreviewTemplate('mentors', MentorPreview);

      // カスタムウィジェットの設定（必要に応じて）
      // CMS.registerWidget('custom-widget', CustomWidget);

      // 初期化完了後の処理
      CMS.registerEventListener({
        name: 'preSave',
        handler: ({ entry }) => {
          // 保存前の処理をここに記述
          console.log('Saving entry:', entry.get('slug'));
        }
      });
    </script>

    <!-- Netlify Identity Widget の初期化 -->
    <script>
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          if (!user) {
            window.netlifyIdentity.on("login", () => {
              document.location.href = "/admin/";
            });
          }
        });
      }
    </script>
  </body>
</html>